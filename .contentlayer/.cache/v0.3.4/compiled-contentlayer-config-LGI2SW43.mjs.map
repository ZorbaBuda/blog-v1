{
  "version": 3,
  "sources": ["../../../contentlayer.config.js", "../../../lib/remark-tok-headings.ts"],
  "sourcesContent": ["import { defineDocumentType } from 'contentlayer/source-files'\nimport { makeSource } from 'contentlayer/source-remote-files';\nimport { spawn } from 'node:child_process';\nimport rehypeAutolinkHeadings from 'rehype-autolink-headings';\nimport rehypeSlug from 'rehype-slug';\nimport  {extractTocHeadings } from './lib/remark-tok-headings'\n\n\nconst BLOG_DIRECTORY = 'blogs';\nconst SYNC_INTERVAL = 1000 * 60;\n\nexport const Post = defineDocumentType(() => ({\n    name: 'Post',\n    filePathPattern: `**/*.mdx`,\n    contentType: 'mdx',\n    fields: {\n        title: { type: 'string', required: true },\n        date: { type: 'date', required: true },\n        tags: { type: 'list', of: { type: 'string' }, default: [] },\n        lastmod: { type: 'date' },\n        draft: { type: 'boolean' },\n        // coverImage: { type: 'string', required: true },\n         banner: { type: 'string', required: true },\n        summary: { type: 'string' },\n        images: { type: 'list', of: { type: 'string' } },\n        authors: { type: 'list', of: { type: 'string' } },\n        layout: { type: 'string' },\n        bibliography: { type: 'string' },\n        canonicalUrl: { type: 'string' },\n    \n      },\n    computedFields: {\n        url: {\n          type: 'string',\n          resolve: (doc) => doc._raw.flattenedPath,\n        },\n        slug: {\n          type: 'string',\n          resolve: (doc) => doc._raw.sourceFileName.split('.')[0],\n        },\n        filePath: {\n          type: 'string',\n          resolve: (doc) => doc._raw.sourceFilePath,\n        },\n         toc: { type: 'string', resolve: (doc) => extractTocHeadings(doc.body.raw) },\n      },\n\n}))\n\nconst syncContentFromGit = async ({ contentDir, gitTag }) => {\n  const startTime = Date.now();\n  console.log(`Syncing content files from git (${gitTag}) to ${contentDir}`);\n  console.log('\\n')\n  console.log(`\"gitTag: \" ${gitTag}`)  \n console.log(`\"contentDir:\" ${contentDir}`)\n\n  const syncRun = async () => {\n    const gitUrl = \"https://github.com/ZorbaBuda/blog-v1.git\";\n    await runBashCommand(`\n    \n      if [ -d  \"${contentDir}\" ];\n        then\n          cd \"${contentDir}\"; \n          git pull;\n          \n        else\n          git clone --depth 1 --single-branch ${gitUrl} ${contentDir};\n      fi\n    `);\n  };\n\n \n\n  let wasCancelled = false;\n  let syncInterval;\n\n  const syncLoop = async () => {\n    console.log(\"Syncing content files from git\");\n\n    await syncRun();\n\n    if (wasCancelled) return;\n\n    syncInterval = setTimeout(syncLoop, 1000 * 60);\n  };\n\n  // Block until the first sync is done\n  await syncLoop();\n\n  return () => {\n    wasCancelled = true;\n    clearTimeout(syncInterval);\n  };\n};\n\n// const syncContentFromGit = async ({\n//     contentDir,\n//     gitTag,\n//   }) => {\n//     const startTime = Date.now();\n//     console.log(`Syncing content files from git (${gitTag}) to ${contentDir}`);\n  \n//     const syncRun = async () => {\n//       const gitUrl = 'https://github.com/ZorbaBuda/blog-github-mdx.git';\n//       console.log(gitUrl)\n//       await runBashCommand(`\n//         #! /usr/bin/env bash\n  \n//         sync_lock_file=\"${contentDir}/.sync.lock\"\n  \n//         function contentlayer_sync_run () {\n//           block_if_locked;\n  \n//           mkdir -p ${contentDir};\n//           touch $sync_lock_file;\n  \n//           if [ -d \"${contentDir}/.git\" ];\n//             then\n//               cd \"${contentDir}\";\n//               git fetch --quiet --depth=1 origin ${gitTag};\n//               git checkout --quiet FETCH_HEAD;\n//             else\n//               git init --quiet ${contentDir};\n//               cd ${contentDir};\n//               git remote add origin ${gitUrl};\n//               git config core.sparsecheckout true;\n//               git config advice.detachedHead false;\n//               echo \"${BLOG_DIRECTORY}/*\" >> .git/info/sparse-checkout;\n//               git checkout --quiet -b ${gitTag};\n//               git fetch --quiet --depth=1 origin ${gitTag};\n//               git checkout --quiet FETCH_HEAD;\n//           fi\n  \n//           rm $sync_lock_file;\n//         }\n  \n//         function block_if_locked () {\n//           if [ -f \"$sync_lock_file\" ];\n//             then\n//               while [ -f \"$sync_lock_file\" ]; do sleep 1; done;\n//               exit 0;\n//           fi\n//         }\n  \n//         contentlayer_sync_run\n//       `);\n//     };\n  \n//     let wasCancelled = false;\n//     let syncInterval;\n  \n//     const syncLoop = async () => {\n//       await syncRun();\n  \n//       if (wasCancelled) return;\n  \n//       syncInterval = setTimeout(syncLoop, SYNC_INTERVAL); // sync every minute\n//     };\n  \n//     // Block until the first sync is done\n//     await syncLoop();\n  \n//     const initialSyncDuration = ((Date.now() - startTime) / 1000).toPrecision(2);\n//     console.log(\n//       `Initial sync of content files from git took ${initialSyncDuration}s (still syncing every minute...)`\n//     );\n  \n//     return () => {\n//       wasCancelled = true;\n//       clearTimeout(syncInterval);\n//     };\n//   };\n  \n  const runBashCommand = (command) =>\n    new Promise((resolve, reject) => {\n      const child = spawn(command, [], { shell: `${process.env.SHELL_GIT_BASH}` });\n  \n      const logMessages = [];\n  \n      child.stdout.setEncoding('utf8');\n      child.stdout.on('data', (data) => {\n        logMessages.push(data);\n        process.stdout.write(data);\n      });\n  \n      child.stderr.setEncoding('utf8');\n      child.stderr.on('data', (data) => {\n        logMessages.push(data);\n        process.stderr.write(data);\n      });\n  \n      child.on('close', function (code) {\n        if (code === 0) {\n          resolve(void 0);\n        } else {\n          const logStr = logMessages.join('\\n');\n          \n          reject(\n            new Error(`Command failed with exit code ${code}:\\n\\n${logStr}`)\n          );\n        }\n      });\n  });\n\nexport default makeSource((sourceKey = 'main') => (\n \n    { \n        syncFiles: (contentDir) =>\n        syncContentFromGit({ contentDir, gitTag: sourceKey }),\n        // contentDirPath: `blog-${sourceKey}`,\n        contentDirPath: `blogs`,\n        // contentDirInclude: [BLOG_DIRECTORY],\n        documentTypes: [Post],\n        disableImportAliasWarning: true,\n        mdx: {\n          rehypePlugins: [\n            rehypeSlug,\n            [\n              rehypeAutolinkHeadings,\n              {\n                properties: {\n                  className: [\"subheading-anchor\"],\n                  ariaLabel: \"Link to section\",\n                },\n              },\n            ],\n          ]\n        }\n       \n    }\n))\n", "\nimport { VFile } from 'vfile'\nimport { Parent } from 'unist'\nimport { visit } from 'unist-util-visit'\nimport { Heading } from 'mdast'\nimport slugger from 'github-slugger'\nimport { toString } from 'mdast-util-to-string'\nimport { remark } from 'remark'\n\nexport type Toc = {\n  value: string\n  depth: number\n  url: string\n}[]\n\n/**\n * Extracts TOC headings from markdown file and adds it to the file's data object.\n */\nexport function remarkTocHeadings() {\n  return (tree: Parent, file: VFile) => {\n    const toc: Toc = []\n    visit(tree, 'heading', (node: Heading) => {\n      const textContent = toString(node)\n      toc.push({\n        value: textContent,\n        url: '#' + slugger.slug(textContent),\n        depth: node.depth,\n      })\n    })\n    file.data.toc = toc\n  }\n}\n\n/**\n * Passes markdown file through remark to extract TOC headings\n *\n * @param {string} markdown\n * @return {*}  {Promise<Toc>}\n */\nexport async function extractTocHeadings(markdown: string): Promise<Toc> {\n  const vfile = await remark().use(remarkTocHeadings).process(markdown)\n  // @ts-ignore\n  return vfile.data.toc\n}\n"],
  "mappings": "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",
  "names": []
}
